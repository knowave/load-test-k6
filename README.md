# k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸

Express.js ê¸°ë°˜ API ì„œë²„ì™€ k6ë¥¼ í™œìš©í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸ í•™ìŠµ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
load-test-k6/
â”œâ”€â”€ src/                    # Express API ì„œë²„
â”‚   â”œâ”€â”€ main.ts            # ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ app.ts             # Application ì„¤ì •
â”‚   â”œâ”€â”€ app.controller.ts  # Controller ë ˆì´ì–´ (HTTP ìš”ì²­/ì‘ë‹µ)
â”‚   â””â”€â”€ app.service.ts     # Service ë ˆì´ì–´ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
â”œâ”€â”€ k6/                     # k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ load-test.ts   # í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”‚   â””â”€â”€ types.d.ts     # íƒ€ì… ì„ ì–¸
â”‚   â”œâ”€â”€ results/           # í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸
â”‚   â”œâ”€â”€ webpack.config.js  # ë²ˆë“¤ëŸ¬ ì„¤ì •
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# API ì„œë²„ ì˜ì¡´ì„±
yarn install

# k6 í…ŒìŠ¤íŠ¸ ì˜ì¡´ì„±
cd k6
yarn install
```

### 2. k6 CLI ì„¤ì¹˜ (macOS)

```bash
brew install k6
```

### 3. ì„œë²„ ì‹¤í–‰

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ
yarn dev
```

### 4. ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# k6 í´ë”ì—ì„œ
cd k6
yarn test
```

---

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

| ì—”ë“œí¬ì¸íŠ¸              | ë©”ì„œë“œ | ë¶€í•˜ ìœ í˜•   | ì„¤ëª…                |
| ----------------------- | ------ | ----------- | ------------------- |
| `/api/health`           | GET    | Baseline    | í—¬ìŠ¤ì²´í¬ (ê¸°ì¤€ì )   |
| `/api/cpu-intensive`    | GET    | **CPU**     | CPU ì§‘ì•½ì  ì‘ì—…     |
| `/api/memory-intensive` | GET    | **Memory**  | ë©”ëª¨ë¦¬ ì§‘ì•½ì  ì‘ì—…  |
| `/api/io-delay`         | GET    | **I/O**     | I/O ì§€ì—° ì‹œë®¬ë ˆì´ì…˜ |
| `/api/echo`             | POST   | ë™ì‹œì„±      | POST ìš”ì²­ ì²˜ë¦¬      |
| `/api/payload/:size`    | GET    | **Network** | ê°€ë³€ ì‘ë‹µ í¬ê¸°      |

---

## ğŸ”¬ API ìƒì„¸ ì„¤ëª…

### 1. Health Check (`/api/health`)

**ëª©ì **: ì„œë²„ ìƒíƒœ í™•ì¸ìš© ê¸°ì¤€ì  API

```bash
curl http://localhost:3000/api/health
```

```json
{
    "status": "ok",
    "timestamp": 1701412800000
}
```

**ë¶€í•˜ íŠ¹ì„±**: ê±°ì˜ ì—†ìŒ â†’ ë‹¤ë¥¸ APIì™€ ë¹„êµí•˜ê¸° ìœ„í•œ baseline

---

### 2. CPU Intensive (`/api/cpu-intensive`)

**ëª©ì **: CPU ë°”ìš´ë“œ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜

```bash
curl http://localhost:3000/api/cpu-intensive?n=35
```

| íŒŒë¼ë¯¸í„° | íƒ€ì…   | ê¸°ë³¸ê°’ | ì„¤ëª…                              |
| -------- | ------ | ------ | --------------------------------- |
| `n`      | number | 35     | í”¼ë³´ë‚˜ì¹˜ ìˆ˜ì—´ ê³„ì‚° ê¹Šì´ (ìµœëŒ€ 45) |

**ë¡œì§**: ì¬ê·€ í”¼ë³´ë‚˜ì¹˜ ì•Œê³ ë¦¬ì¦˜ (ì‹œê°„ë³µì¡ë„ O(2^n))

```typescript
private fibonacci(num: number): number {
    if (num <= 1) return num;
    return this.fibonacci(num - 1) + this.fibonacci(num - 2);
}
```

**ì‘ë‹µ ì‹œê°„ ì˜ˆìƒ**:

-   n=35 â†’ ~100ms
-   n=40 â†’ ~1ì´ˆ
-   n=45 â†’ ~10ì´ˆ

**í…ŒìŠ¤íŠ¸ ì˜ë„**: ë™ì‹œ ìš”ì²­ ì¦ê°€ ì‹œ CPU ê²½í•©ìœ¼ë¡œ ì¸í•œ ì‘ë‹µ ì‹œê°„ ì¦ê°€ íŒ¨í„´ ê´€ì°°

---

### 3. Memory Intensive (`/api/memory-intensive`)

**ëª©ì **: ë©”ëª¨ë¦¬ ì••ë°• ìƒí™© ì‹œë®¬ë ˆì´ì…˜

```bash
curl http://localhost:3000/api/memory-intensive?size=100000
```

| íŒŒë¼ë¯¸í„° | íƒ€ì…   | ê¸°ë³¸ê°’ | ì„¤ëª…                               |
| -------- | ------ | ------ | ---------------------------------- |
| `size`   | number | 100000 | ìƒì„±í•  ë°°ì—´ í¬ê¸° (ìµœëŒ€ 10,000,000) |

**ë¡œì§**: ëŒ€ìš©ëŸ‰ ê°ì²´ ë°°ì—´ ìƒì„± â†’ reduceë¡œ ìˆœíšŒ ê³„ì‚°

```typescript
const arr = Array.from({ length: size }, (_, i) => ({
    id: i,
    value: Math.random(),
    data: `item-${i}`,
}));
const sum = arr.reduce((acc, item) => acc + item.value, 0);
```

**í…ŒìŠ¤íŠ¸ ì˜ë„**:

-   GC(Garbage Collection) íŠ¸ë¦¬ê±° ì‹œ ì‘ë‹µ ì§€ì—° ìŠ¤íŒŒì´í¬
-   ë™ì‹œ ìš”ì²­ ì‹œ OOM(Out of Memory) ê°€ëŠ¥ì„± í™•ì¸

---

### 4. I/O Delay (`/api/io-delay`)

**ëª©ì **: DB ì¿¼ë¦¬, ì™¸ë¶€ API í˜¸ì¶œ ë“± I/O ëŒ€ê¸° ì‹œë®¬ë ˆì´ì…˜

```bash
curl http://localhost:3000/api/io-delay?delay=100
```

| íŒŒë¼ë¯¸í„° | íƒ€ì…   | ê¸°ë³¸ê°’ | ì„¤ëª…                       |
| -------- | ------ | ------ | -------------------------- |
| `delay`  | number | 100    | ëŒ€ê¸° ì‹œê°„ (ms, ìµœëŒ€ 10000) |

**ë¡œì§**: `setTimeout`ìœ¼ë¡œ ë¹„ë™ê¸° ëŒ€ê¸°

```typescript
await new Promise((resolve) => setTimeout(resolve, delay));
```

**í…ŒìŠ¤íŠ¸ ì˜ë„**:

-   CPUëŠ” ê±°ì˜ ì‚¬ìš© ì•ˆ í•¨
-   ì»¤ë„¥ì…˜ ì ìœ  ìƒíƒœ ìœ ì§€
-   ë™ì‹œ ìš”ì²­ ì‹œ ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ ì‹œë®¬ë ˆì´ì…˜

---

### 5. Echo (`/api/echo`)

**ëª©ì **: POST ìš”ì²­ ì²˜ë¦¬ ë° JSON íŒŒì‹±/ì§ë ¬í™” í…ŒìŠ¤íŠ¸

```bash
curl -X POST http://localhost:3000/api/echo \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'
```

**í…ŒìŠ¤íŠ¸ ì˜ë„**: ë™ì‹œ POST ìš”ì²­ ì²˜ë¦¬ ëŠ¥ë ¥, ëŒ€ìš©ëŸ‰ body ì²˜ë¦¬ ì‹œ ì˜¤ë²„í—¤ë“œ

---

### 6. Variable Payload (`/api/payload/:size`)

**ëª©ì **: ì‘ë‹µ í¬ê¸°ë³„ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

```bash
curl http://localhost:3000/api/payload/large
```

| size     | ì•„ì´í…œ ìˆ˜ | ì˜ˆìƒ ì‘ë‹µ í¬ê¸° |
| -------- | --------- | -------------- |
| `small`  | 100       | ~1KB           |
| `medium` | 1,000     | ~10KB          |
| `large`  | 10,000    | ~100KB         |
| `xlarge` | 100,000   | ~1MB           |

**í…ŒìŠ¤íŠ¸ ì˜ë„**: ëŒ€ìš©ëŸ‰ ì‘ë‹µ ì „ì†¡ ì‹œ ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­, JSON ì§ë ¬í™” ì‹œê°„ ì¸¡ì •

---

## ğŸ§ª k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

```
VUs(ê°€ìƒ ì‚¬ìš©ì)
 10 â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          /                   \
  5 â”‚         /                     \
    â”‚        /                       \
  0 â”‚â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€
    0      10s        40s           50s
         Ramp-up     Peak        Ramp-down
```

| ë‹¨ê³„      | ì‹œê°„   | VUs  | ì„¤ëª…             |
| --------- | ------ | ---- | ---------------- |
| Ramp-up   | 0~10s  | 0â†’5  | ì ì§„ì  ë¶€í•˜ ì¦ê°€ |
| Peak      | 10~40s | 5â†’10 | ìµœëŒ€ ë¶€í•˜ ìœ ì§€   |
| Ramp-down | 40~50s | 10â†’0 | ì ì§„ì  ë¶€í•˜ ê°ì†Œ |

### ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

```bash
cd k6

# ê¸°ë³¸ í…ŒìŠ¤íŠ¸ (50ì´ˆ, ìµœëŒ€ 10 VUs)
yarn test

# ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ (10ì´ˆ, 5 VUs)
yarn test:quick

# ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ (60ì´ˆ, 10 VUs)
yarn test:stress
```

### í…ŒìŠ¤íŠ¸ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  setup() â”‚ â†’   â”‚ default()â”‚ â†’   â”‚teardown()â”‚
â”‚ (1íšŒ)    â”‚     â”‚ (ë°˜ë³µ)   â”‚     â”‚ (1íšŒ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
              ê° VUê°€ ë°˜ë³µ ì‹¤í–‰
                      â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ healthCheck â†’ cpu â†’ memory â†’ io â†’   â”‚
    â”‚ echo â†’ payload (0.5ì´ˆ ê°„ê²©)          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­

| ë©”íŠ¸ë¦­                      | íƒ€ì…    | ì„¤ëª…                       |
| --------------------------- | ------- | -------------------------- |
| `health_check_duration`     | Trend   | í—¬ìŠ¤ì²´í¬ ì‘ë‹µ ì‹œê°„ ë¶„í¬    |
| `cpu_intensive_duration`    | Trend   | CPU ì‘ì—… ì‘ë‹µ ì‹œê°„ ë¶„í¬    |
| `memory_intensive_duration` | Trend   | ë©”ëª¨ë¦¬ ì‘ì—… ì‘ë‹µ ì‹œê°„ ë¶„í¬ |
| `io_delay_duration`         | Trend   | I/O ì§€ì—° ì‘ë‹µ ì‹œê°„ ë¶„í¬    |
| `payload_duration`          | Trend   | í˜ì´ë¡œë“œ ì‘ë‹µ ì‹œê°„ ë¶„í¬    |
| `errors`                    | Rate    | ì—ëŸ¬ ë°œìƒë¥                 |
| `total_requests`            | Counter | ì´ ìš”ì²­ ìˆ˜                 |

### ì„ê³„ê°’ (Thresholds)

```typescript
thresholds: {
    http_req_duration: ['p(95)<2000'], // 95% ìš”ì²­ì´ 2ì´ˆ ì´ë‚´
    errors: ['rate<0.1'],              // ì—ëŸ¬ìœ¨ 10% ë¯¸ë§Œ
}
```

---

## ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸

í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ `k6/results/` í´ë”ì— ìƒì„±ë©ë‹ˆë‹¤:

```
k6/results/
â”œâ”€â”€ report-2025-12-01T06-42-16-247Z.html  # HTML ë¦¬í¬íŠ¸
â””â”€â”€ summary-2025-12-01T06-42-16-247Z.json # JSON ìš”ì•½
```

### HTML ë¦¬í¬íŠ¸ ì—´ê¸°

```bash
open k6/results/report-*.html
```

### ë¦¬í¬íŠ¸ ë‚´ìš©

-   **Thresholds**: ì„ê³„ê°’ í†µê³¼/ì‹¤íŒ¨ ì—¬ë¶€
-   **Checks**: ê° ê²€ì¦ í•­ëª© ì„±ê³µë¥ 
-   **HTTP Metrics**: ìš”ì²­ ì‹œê°„, ì²˜ë¦¬ëŸ‰ ë“±
-   **Custom Metrics**: ì—”ë“œí¬ì¸íŠ¸ë³„ ì‘ë‹µ ì‹œê°„ ë¶„í¬

---

## ğŸ“ˆ ì˜ˆìƒ ê²°ê³¼ ë¶„ì„

| ì—”ë“œí¬ì¸íŠ¸          | ë³‘ëª© ìœ í˜•   | ë™ì‹œ ìš”ì²­ ì¦ê°€ ì‹œ ì˜ˆìƒ í˜„ìƒ     |
| ------------------- | ----------- | ------------------------------- |
| `/health`           | ì—†ìŒ        | ì¼ì •í•œ ë‚®ì€ ì‘ë‹µ ì‹œê°„ ìœ ì§€      |
| `/cpu-intensive`    | **CPU**     | ì‘ë‹µ ì‹œê°„ ì„ í˜• ì¦ê°€             |
| `/memory-intensive` | **Memory**  | GC ì‹œ ê¸‰ê²©í•œ ì§€ì—° ìŠ¤íŒŒì´í¬      |
| `/io-delay`         | **I/O**     | ì»¤ë„¥ì…˜ í’€ í•œê³„ ë„ë‹¬ ì‹œ íƒ€ì„ì•„ì›ƒ |
| `/echo`             | íŒŒì‹±        | ì•ˆì •ì  (ëŒ€ìš©ëŸ‰ body ì‹œ ì¦ê°€)    |
| `/payload`          | **Network** | large/xlargeì—ì„œ ì „ì†¡ ì‹œê°„ ì¦ê°€ |

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

### API ì„œë²„

-   **Runtime**: Node.js
-   **Framework**: Express.js 5.x
-   **Language**: TypeScript

### ë¶€í•˜ í…ŒìŠ¤íŠ¸

-   **Tool**: k6 (Grafana)
-   **Language**: TypeScript
-   **Bundler**: Webpack
-   **Reporter**: k6-reporter

---

## ğŸ“š ì°¸ê³  ìë£Œ

-   [k6 Documentation](https://k6.io/docs/)
-   [k6-reporter GitHub](https://github.com/benc-uk/k6-reporter)
-   [Express.js Documentation](https://expressjs.com/)
